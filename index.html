<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>livres de Prestige - Mini Librairie</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        h1, h2 {
            font-family: 'Playfair Display', serif;
        }
        .book-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .modal.active {
            display: flex;
        }
        .category-pill.active {
            background-color: #4f46e5;
            color: white;
        }
        #cart-drawer {
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }
        #cart-drawer.open {
            transform: translateX(0);
        }
    </style>
</head>
<body>

    <header class="bg-white border-b sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-900">Librairie De Demain</h1>
            <div class="flex gap-4 items-center">
                <button onclick="toggleCart()" class="relative p-2 text-gray-700 hover:text-indigo-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
                </button>
                <button onclick="openAdminAuth()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-semibold transition">
                    Admin
                </button>
            </div>
        </div>
    </header>

    <div id="cart-overlay" onclick="toggleCart()" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden opacity-0 transition-opacity duration-300"></div>
    
    <div id="cart-drawer" class="fixed right-0 top-0 h-full w-full max-w-sm bg-white z-[60] shadow-2xl flex flex-col text-gray-800">
        <div class="p-6 border-b flex justify-between items-center bg-indigo-900 text-white">
            <h2 class="text-xl font-bold">Votre Panier</h2>
            <button onclick="toggleCart()" class="text-white hover:text-indigo-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4">
            <p class="text-gray-500 text-center py-10">Votre panier est vide.</p>
        </div>

        <div class="p-6 border-t bg-gray-50">
            <div class="mb-4">
                <label class="block text-xs font-bold text-gray-600 uppercase mb-1">Au nom de :</label>
                <input type="text" id="client-name" placeholder="Ton nom complet" class="w-full border p-3 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
            </div>

            <div class="flex justify-between items-center mb-6">
                <span class="text-gray-600 font-semibold">Total</span>
                <span id="cart-total" class="text-2xl font-bold text-indigo-900">0 ‚Ç¨</span>
            </div>

            <button onclick="checkout()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg active:scale-95 disabled:bg-gray-400 disabled:pointer-events-none" id="btn-checkout" disabled>
                Valider l'achat
            </button>
        </div>
    </div>

    <section class="py-12 bg-indigo-900 text-white">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <h2 class="text-4xl md:text-5xl mb-4 text-white">L'art des livres d'or</h2>
            <p class="text-indigo-200 text-lg max-w-2xl mx-auto">Choisissez votre cat√©gorie et profitez de votre achat de prestige.</p>
        </div>
    </section>

<div class="relative w-full h-44 overflow-hidden flex items-center justify-center shadow-lg border-b border-white/20">
    <div id="category-bg" class="absolute inset-0 bg-cover bg-center scale-110 blur-md opacity-70 transition-all duration-700"></div>
    
    <div class="absolute inset-0 bg-black/30"></div>

    <div class="relative z-10 flex items-center justify-between w-full px-6 max-w-lg">
        <button onclick="prevCategory()" class="bg-white/10 hover:bg-white/30 text-white w-12 h-12 rounded-full backdrop-blur-md flex items-center justify-center transition-all active:scale-90 shadow-lg border border-white/20">‚ùÆ</button>
        
        <div class="text-center">
            <h2 id="current-cat-name" class="text-white text-2xl font-black italic tracking-[0.2em] uppercase drop-shadow-md">Tous</h2>
            <div class="h-1 w-8 bg-indigo-400 mx-auto mt-1 rounded-full shadow-glow"></div>
        </div>

        <button onclick="nextCategory()" class="bg-white/10 hover:bg-white/30 text-white w-12 h-12 rounded-full backdrop-blur-md flex items-center justify-center transition-all active:scale-90 shadow-lg border border-white/20">‚ùØ</button>
    </div>
</div>

    <main class="max-w-6xl mx-auto px-4 py-12">
        <div id="book-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></div>
    </main>

    <div id="auth-modal" class="modal">
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md mx-4 text-gray-800">
            <h3 class="text-xl font-bold mb-4">Acc√®s Restreint</h3>
            <input type="password" id="admin-code" placeholder="Code secret" class="w-full border p-3 rounded-lg mb-4 focus:ring-2 focus:ring-indigo-500 outline-none">
            <div class="flex gap-3">
                <button onclick="closeModal('auth-modal')" class="flex-1 py-2 text-gray-500">Annuler</button>
                <button onclick="verifyCode()" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg font-bold">Valider</button>
            </div>
        </div>
    </div>

    <div id="add-modal" class="modal">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md mx-4 text-gray-800">
        <h3 class="text-xl font-bold mb-4">Ajouter un livre</h3>
        <div class="space-y-4">
            <input type="text" id="new-name" placeholder="Nom du livre" class="w-full border p-2 rounded-lg">
            <select id="new-category" class="w-full border p-2 rounded-lg">
                <option value="Roman">Roman</option>
                <option value="Aventure">Aventure</option>
                <option value="Histoire">Histoire</option>
                <option value="Manga">Manga</option>
                <option value="Horreur">Horreur</option>
            </select>
            <input type="number" id="new-price" placeholder="Prix (‚Ç¨)" class="w-full border p-2 rounded-lg">
            <input type="file" id="new-image" accept="image/*" class="w-full text-sm">
            <!-- Champ PDF ajout√© ici -->
            <input type="file" id="new-pdf" accept="application/pdf" class="w-full text-sm">
            <button onclick="addNewBook()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold mt-4 hover:bg-green-700">Publier</button>
            <button onclick="closeModal('add-modal')" class="w-full text-gray-400 text-sm">Fermer</button>
        </div>
    </div>
</div>

    <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-indigo-900 text-white px-8 py-3 rounded-full shadow-2xl transform translate-y-20 opacity-0 transition-all duration-300 pointer-events-none z-50 text-sm font-semibold">
        Ajout√© !
    </div>

<script type="module">
// 1. IMPORTATION DES MODULES FIREBASE (AVEC STORAGE)
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

// 2. TA CONFIGURATION
const firebaseConfig = {
    apiKey: "AIzaSyBX9uaBYEevShGWMXK0Owoj216ehlj000E",
    authDomain: "livres-de-prestiges.firebaseapp.com",
    projectId: "livres-de-prestiges",
    storageBucket: "livres-de-prestiges.firebasestorage.app",
    messagingSenderId: "1053280749548",
    appId: "1:1053280749548:web:1cb0a0af92b350c05762c9"
};

// Initialisation des services
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app); // C'est cette ligne qui permet de g√©rer les PDF
const booksCol = collection(db, "books");

    const SECRET_CODE = "$0Ul4yM4NE&25137";
    let currentFilter = "Tous";
    let cart = [];
    let books = []; 
    let isAdminActive = false;

    // 3. LECTURE EN TEMPS R√âEL (SYNCHRONISATION)
    onSnapshot(booksCol, (snapshot) => {
        books = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderBooks();
    });

    window.renderBooks = function() {
        const grid = document.getElementById('book-grid');
        if (!grid) return;
        grid.innerHTML = '';
        const filtered = currentFilter === "Tous" ? books : books.filter(b => b.category === currentFilter);

        if(filtered.length === 0) {
            grid.innerHTML = '<div class="col-span-full text-center py-20 text-gray-400">Aucun livre √† afficher. Attendez que le libraire en ajoute.</div>';
            return;
        }

        filtered.forEach(book => {
            let adminButtons = isAdminActive ? `
                <div class="flex gap-2 mt-2">
                    <button onclick="editBook('${book.id}')" class="flex-1 bg-emerald-500 text-white py-1 rounded text-xs font-bold">Prix</button>
                    <button onclick="deleteBook('${book.id}')" class="flex-1 bg-red-500 text-white py-1 rounded text-xs font-bold">Suppr.</button>
                </div>` : '';

            grid.innerHTML += `
                <div class="book-card bg-white rounded-xl overflow-hidden border border-gray-100 shadow-sm">
                    <div class="h-72 overflow-hidden bg-gray-200 relative">
                        <span class="absolute top-3 left-3 bg-indigo-600 text-white text-[10px] uppercase font-bold px-2 py-1 rounded shadow-lg z-10">${book.category}</span>
                        <img src="${book.image}" alt="${book.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-lg text-gray-800 mb-1 truncate">${book.name}</h3>
                        <p class="text-indigo-600 font-bold mb-4 text-xl">${book.price} ‚Ç¨</p>
                        <button onclick="addToCart('${book.id}')" class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-bold">Ajouter au panier</button>
                        ${adminButtons}
                    </div>
                </div>`;
        });
    }

// 4. LOGIQUE D'AJOUT (CLOUD STORAGE - VERSION PDF)
window.addNewBook = async function() {
    const btn = document.querySelector('button[onclick="addNewBook()"]'); // Rep√®re le bouton
    const name = document.getElementById('new-name').value;
    const cat = document.getElementById('new-category').value;
    const price = document.getElementById('new-price').value;
    const imageFile = document.getElementById('new-image').files[0];
    const pdfFile = document.getElementById('new-pdf').files[0];

    if(!name || !price || !imageFile || !pdfFile) return alert("Le dossier de l'ouvrage est incomplet !");
    
    // On change le texte du bouton pour faire patienter l'utilisateur
    btn.disabled = true; 
    btn.textContent = "Signature num√©rique en cours...";

    try {
        const timestamp = Date.now();
        
        // 1. Envoi de la couverture
        const imgRef = ref(storage, `covers/${timestamp}_${imageFile.name}`);
        await uploadBytes(imgRef, imageFile);
        const imgUrl = await getDownloadURL(imgRef);

        // 2. Envoi du manuscrit (PDF)
        const pdfRef = ref(storage, `pdfs/${timestamp}_${pdfFile.name}`);
        await uploadBytes(pdfRef, pdfFile);
        const pdfUrl = await getDownloadURL(pdfRef);

        // 3. Enregistrement final dans la base de donn√©es
        await addDoc(booksCol, { 
            name, 
            category: cat, 
            price: parseFloat(price).toFixed(2), 
            image: imgUrl, 
            pdf: pdfUrl 
        });
        
        closeModal('add-modal');
        showToast("L'ouvrage a rejoint la collection officielle !");
        
        // Nettoyage des champs
        document.getElementById('new-name').value = '';
        document.getElementById('new-price').value = '';
    } catch(e) { 
        alert("Erreur lors du d√©ploiement : " + e.message); 
    } finally { 
        btn.disabled = false; 
        btn.textContent = "Publier"; 
    }
};

    // 5. FONCTIONS GLOBALES (ADMIN & PANIER)
    window.deleteBook = async function(id) {
        if(confirm("Supprimer d√©finitivement ?")) await deleteDoc(doc(db, "books", id));
    }

    window.editBook = async function(id) {
        const nPrice = prompt("Nouveau prix :");
        if(nPrice) await updateDoc(doc(db, "books", id), { price: nPrice });
    }

    window.addToCart = function(id) {
        const book = books.find(b => b.id === id);
        if(book) {
            cart.push({...book, cartId: Date.now()});
            updateCartBadge();
            showToast(`"${book.name}" ajout√© !`);
        }
    }

    window.toggleCart = function() {
        const drawer = document.getElementById('cart-drawer');
        const overlay = document.getElementById('cart-overlay');
        drawer.classList.toggle('open');
        overlay.classList.toggle('hidden');
        renderCart();
    }

    window.updateCartBadge = function() {
        const badge = document.getElementById('cart-count');
        badge.textContent = cart.length;
        badge.classList.toggle('hidden', cart.length === 0);
    }

    window.renderCart = function() {
        const container = document.getElementById('cart-items');
        const totalEl = document.getElementById('cart-total');
        const btnCheckout = document.getElementById('btn-checkout');
        
        if(cart.length === 0) {
            container.innerHTML = '<p class="text-gray-500 text-center py-10">Panier vide.</p>';
            totalEl.textContent = '0 ‚Ç¨';
            btnCheckout.disabled = true;
            return;
        }
        
        btnCheckout.disabled = false;
        let total = 0;
        container.innerHTML = '';
        cart.forEach(item => {
            total += parseFloat(item.price);
            container.innerHTML += `
                <div class="flex items-center gap-4 bg-gray-50 p-3 rounded-xl">
                    <img src="${item.image}" class="w-12 h-16 object-cover rounded">
                    <div class="flex-1">
                        <h4 class="font-bold text-xs">${item.name}</h4>
                        <p class="text-indigo-600 text-xs font-bold">${item.price} ‚Ç¨</p>
                    </div>
                    <button onclick="removeFromCart(${item.cartId})" class="text-red-400">√ó</button>
                </div>`;
        });
        totalEl.textContent = `${total} ‚Ç¨`;
    }

    window.removeFromCart = function(cartId) {
        cart = cart.filter(i => i.cartId !== cartId);
        updateCartBadge();
        renderCart();
    }

    window.checkout = async function() {
        const clientName = document.getElementById('client-name').value;
        if (!clientName.trim()) return alert("Entre ton nom !");

        const message = `üö® NOUVELLE VENTE !\nüë§ NOM : ${clientName}\nüìñ Livres : ${names}\nüí∞ TOTAL : ${total} ‚Ç¨\nüóìÔ∏è Date : ${new Date().toLocaleString()}`;
        const TOKEN = "8383616774:AAGabewvnb_ix_84drSiTo9U-x68p_Znl-o";
        const CHAT_ID = "8296720386";
        
        await fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: CHAT_ID, text: message })
        });

        alert("Merci pour votre achat !");
        cart = [];
        updateCartBadge();
        toggleCart();
    }

    window.filterCategory = (cat) => {
        currentFilter = cat;
        document.querySelectorAll('.category-pill').forEach(btn => {
            btn.classList.toggle('active', btn.textContent === cat);
        });
        renderBooks();
    }
    
    window.openAdminAuth = () => document.getElementById('auth-modal').classList.add('active');
    window.closeModal = (id) => document.getElementById(id).classList.remove('active');
    window.verifyCode = () => {
        if(document.getElementById('admin-code').value === SECRET_CODE) {
            isAdminActive = true;
            closeModal('auth-modal');
            document.getElementById('add-modal').classList.add('active');
            renderBooks();
        } else { alert("Code faux !"); }
    }
    
    window.showToast = (msg) => {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.remove('opacity-0', 'translate-y-20');
        setTimeout(() => t.classList.add('opacity-0', 'translate-y-20'), 2500);
    }
</script>
</body>
</html>
