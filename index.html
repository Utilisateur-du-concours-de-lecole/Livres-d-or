<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Livres de Prestige - Librairie d'Excellence</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap');
Â  Â  Â  Â  body { font-family: 'Inter', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
Â  Â  Â  Â  h1, h2, h3 { font-family: 'Playfair Display', serif; }
Â  Â  Â  Â  .book-card { transition: all 0.3s ease; }
Â  Â  Â  Â  .book-card:hover { transform: translateY(-8px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 100; padding: 20px; }
Â  Â  Â  Â  .modal.active { display: flex; }
Â  Â  Â  Â  .category-pill.active { background-color: #4f46e5; color: white; border-color: #4f46e5; }
Â  Â  Â  Â  #cart-drawer { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); transform: translateX(100%); }
Â  Â  Â  Â  #cart-drawer.open { transform: translateX(0); }
Â  Â  Â  Â  .no-scrollbar::-webkit-scrollbar { display: none; }
Â  Â  </style>
</head>
<body>

<header class="bg-white border-b sticky top-0 z-40 shadow-sm">
Â  Â  <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
Â  Â  Â  Â  <h1 class="text-2xl font-bold text-indigo-900 tracking-tight italic">Livres d'Or</h1>
Â  Â  Â  Â  <div class="flex gap-4 items-center">
Â  Â  Â  Â  Â  Â  <button onclick="toggleCart()" class="relative p-2 text-gray-700 hover:text-indigo-600 transition">
Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button onclick="openAdminAuth()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-semibold transition">AccÃ¨s Admin</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</header>

<div id="cart-overlay" onclick="toggleCart()" class="fixed inset-0 bg-black/50 z-50 hidden opacity-0 transition-opacity duration-300"></div>
<div id="cart-drawer" class="fixed right-0 top-0 h-full w-full max-w-md bg-white z-[60] shadow-2xl flex flex-col">
Â  Â  <div class="p-6 bg-indigo-900 text-white flex justify-between items-center">
Â  Â  Â  Â  <h2 class="text-xl font-bold italic">Votre SÃ©lection</h2>
Â  Â  Â  Â  <button onclick="toggleCart()" class="text-white hover:rotate-90 transition-transform duration-300">
Â  Â  Â  Â  Â  Â  <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
Â  Â  Â  Â  </button>
Â  Â  </div>
Â  Â  <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
Â  Â  <div class="p-6 border-t bg-gray-50">
Â  Â  Â  Â  <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Nom de l'acquÃ©reur</label>
Â  Â  Â  Â  <input type="text" id="client-name" placeholder="Votre nom complet" class="w-full border p-3 rounded-xl mb-4 outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm">
Â  Â  Â  Â  <div class="flex justify-between items-center mb-6 text-indigo-900">
Â  Â  Â  Â  Â  Â  <span class="font-semibold">Montant Total</span>
Â  Â  Â  Â  Â  Â  <span id="cart-total" class="text-2xl font-bold">0.00 â‚¬</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button onclick="checkout()" id="btn-checkout" disabled class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-lg active:scale-95 disabled:bg-gray-300">
Â  Â  Â  Â  Â  Â  Finaliser l'Acquisition
Â  Â  Â  Â  </button>
Â  Â  </div>
</div>

<div class="bg-white border-b sticky top-[73px] z-30 shadow-sm">
Â  Â  <div class="max-w-6xl mx-auto px-4 py-4 flex gap-4 justify-start md:justify-center overflow-x-auto no-scrollbar">
Â  Â  Â  Â  <button onclick="filterCategory('Tous')" class="category-pill active px-8 py-2 rounded-full border border-gray-200 text-sm font-semibold transition">Tous</button>
Â  Â  Â  Â  <button onclick="filterCategory('Roman')" class="category-pill px-8 py-2 rounded-full border border-gray-200 text-sm font-semibold transition">Roman</button>
Â  Â  Â  Â  <button onclick="filterCategory('Histoire')" class="category-pill px-8 py-2 rounded-full border border-gray-200 text-sm font-semibold transition">Histoire</button>
Â  Â  Â  Â  <button onclick="filterCategory('Manga')" class="category-pill px-8 py-2 rounded-full border border-gray-200 text-sm font-semibold transition">Manga</button>
Â  Â  Â  Â  <button onclick="filterCategory('Art')" class="category-pill px-8 py-2 rounded-full border border-gray-200 text-sm font-semibold transition">Art</button>
Â  Â  </div>
</div>

<main class="max-w-6xl mx-auto px-4 py-16">
Â  Â  <div id="book-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-12"></div>
</main>

<div id="reader-modal" class="modal">
Â  Â  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col overflow-hidden">
Â  Â  Â  Â  <div class="p-4 bg-indigo-950 text-white flex justify-between items-center">
Â  Â  Â  Â  Â  Â  <h3 id="reader-title" class="font-bold">Ouvrage NumÃ©rique</h3>
Â  Â  Â  Â  Â  Â  <button onclick="closeModal('reader-modal')" class="hover:text-red-400 transition-all text-3xl font-light">&times;</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <iframe id="pdf-viewer" class="w-full h-full border-none bg-gray-100"></iframe>
Â  Â  </div>
</div>

<div id="auth-modal" class="modal">
Â  Â  <div class="bg-white p-10 rounded-3xl shadow-2xl w-full max-w-sm">
Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-6 text-indigo-900">AccÃ¨s MaÃ®tre</h3>
Â  Â  Â  Â  <input type="password" id="admin-code" placeholder="Code secret" class="w-full border-2 border-gray-100 p-4 rounded-xl mb-6 outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
Â  Â  Â  Â  <div class="flex gap-4">
Â  Â  Â  Â  Â  Â  <button onclick="closeModal('auth-modal')" class="flex-1 text-gray-400 font-semibold py-3">Annuler</button>
Â  Â  Â  Â  Â  Â  <button onclick="verifyCode()" class="flex-1 bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-md">Valider</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div id="add-modal" class="modal">
Â  Â  <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
Â  Â  Â  Â  <h3 class="text-3xl font-bold mb-6 text-indigo-900">Nouvel Ouvrage</h3>
Â  Â  Â  Â  <div class="space-y-6">
Â  Â  Â  Â  Â  Â  <input type="text" id="new-name" placeholder="Titre" class="w-full border-b-2 p-3 outline-none focus:border-indigo-500">
Â  Â  Â  Â  Â  Â  <select id="new-category" class="w-full border-b-2 p-3 outline-none">
Â  Â  Â  Â  Â  Â  Â  Â  <option>Roman</option><option>Histoire</option><option>Manga</option><option>Art</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <input type="number" id="new-price" placeholder="Prix (â‚¬)" class="w-full border-b-2 p-3 outline-none">
Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="new-image" accept="image/*" class="text-[10px]">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="new-pdf" accept="application/pdf" class="text-[10px]">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button onclick="addNewBook()" id="btn-publish" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-bold">Publier</button>
Â  Â  Â  Â  Â  Â  <button onclick="closeModal('add-modal')" class="w-full text-gray-300 text-xs font-bold uppercase">Fermer</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-indigo-950 text-white px-12 py-4 rounded-full shadow-2xl transform translate-y-32 opacity-0 transition-all duration-500 z-[100] text-sm font-bold border border-white/10">Action rÃ©ussie</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

const firebaseConfig = {
Â  Â  apiKey: "AIzaSyBX9uaBYEevShGWMXK0Owoj216ehlj000E",
Â  Â  authDomain: "livres-de-prestiges.firebaseapp.com",
Â  Â  projectId: "livres-de-prestiges",
Â  Â  storageBucket: "livres-de-prestiges.firebasestorage.app",
Â  Â  messagingSenderId: "1053280749548",
Â  Â  appId: "1:1053280749548:web:1cb0a0af92b350c05762c9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);
const booksCol = collection(db, "books");

const SECRET_CODE = "$0Ul4yM4NE&25137";
let currentFilter = "Tous";
let cart = [];
let books = [];Â 
let isAdminActive = false;

onSnapshot(booksCol, (snap) => {
Â  Â  books = snap.docs.map(d => ({ id: d.id, ...d.data() }));
Â  Â  renderBooks();
});

window.renderBooks = function() {
Â  Â  const grid = document.getElementById('book-grid');
Â  Â  grid.innerHTML = '';
Â  Â  const filtered = currentFilter === "Tous" ? books : books.filter(b => b.category === currentFilter);

Â  Â  filtered.forEach(book => {
Â  Â  Â  Â  let adminUI = isAdminActive ? `
Â  Â  Â  Â  Â  Â  <div class="flex gap-4 mt-4 pt-4 border-t">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="editPrice('${book.id}')" class="flex-1 text-[10px] font-black uppercase text-indigo-400">Prix</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteBook('${book.id}')" class="flex-1 text-[10px] font-black uppercase text-red-300">Retirer</button>
Â  Â  Â  Â  Â  Â  </div>` : '';

Â  Â  Â  Â  grid.innerHTML += `
Â  Â  Â  Â  Â  Â  <div class="book-card bg-white rounded-[2rem] overflow-hidden shadow-sm border border-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="h-[22rem] overflow-hidden relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="absolute top-6 left-6 bg-indigo-900/90 text-white text-[10px] font-black px-4 py-1.5 rounded-full z-10">${book.category.toUpperCase()}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${book.image}" class="w-full h-full object-cover">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-2xl text-indigo-950 mb-2 truncate italic">${book.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-indigo-600 font-black text-3xl mb-8">${book.price} â‚¬</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="addToCart('${book.id}')" class="w-full bg-indigo-950 text-white py-5 rounded-2xl font-bold shadow-xl active:scale-95 transition-all">AcquÃ©rir</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${adminUI}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  });
}

window.addNewBook = async function() {
Â  Â  const btn = document.getElementById('btn-publish');
Â  Â  const name = document.getElementById('new-name').value;
Â  Â  const cat = document.getElementById('new-category').value;
Â  Â  const price = document.getElementById('new-price').value;
Â  Â  const imageFile = document.getElementById('new-image').files[0];
Â  Â  const pdfFile = document.getElementById('new-pdf').files[0];

Â  Â  if(!name || !price || !imageFile || !pdfFile) return alert("Remplissez tout le dossier.");
Â  Â  btn.disabled = true; btn.textContent = "Signature chiffrÃ©e...";

Â  Â  try {
Â  Â  Â  Â  const timestamp = Date.now();
Â  Â  Â  Â  const imgRef = ref(storage, `covers/${timestamp}_${imageFile.name}`);
Â  Â  Â  Â  await uploadBytes(imgRef, imageFile);
Â  Â  Â  Â  const imgUrl = await getDownloadURL(imgRef);

Â  Â  Â  Â  const pdfRef = ref(storage, `pdfs/${timestamp}_${pdfFile.name}`);
Â  Â  Â  Â  await uploadBytes(pdfRef, pdfFile);
Â  Â  Â  Â  const pdfUrl = await getDownloadURL(pdfRef);

Â  Â  Â  Â  await addDoc(booksCol, { name, category: cat, price: parseFloat(price).toFixed(2), image: imgUrl, pdf: pdfUrl });
Â  Â  Â  Â  closeModal('add-modal');
Â  Â  Â  Â  showToast("Ouvrage ajoutÃ© !");
Â  Â  Â  Â  document.getElementById('new-name').value = '';
Â  Â  Â  Â  document.getElementById('new-price').value = '';
Â  Â  } catch(e) { alert("Erreur: " + e.message); } finally { btn.disabled = false; btn.textContent = "Publier"; }
};

window.addToCart = function(id) {
Â  Â  const book = books.find(b => b.id === id);
Â  Â  cart.push({...book, cartId: Date.now()});
Â  Â  updateCartBadge();
Â  Â  showToast(`"${book.name}" ajoutÃ©`);
}

window.toggleCart = function() {
Â  Â  const drawer = document.getElementById('cart-drawer');
Â  Â  const overlay = document.getElementById('cart-overlay');
Â  Â  if (!drawer.classList.contains('open')) {
Â  Â  Â  Â  drawer.classList.add('open');
Â  Â  Â  Â  overlay.classList.remove('hidden');
Â  Â  Â  Â  setTimeout(() => overlay.classList.add('opacity-100'), 10);
Â  Â  } else {
Â  Â  Â  Â  drawer.classList.remove('open');
Â  Â  Â  Â  overlay.classList.remove('opacity-100');
Â  Â  Â  Â  setTimeout(() => overlay.classList.add('hidden'), 300);
Â  Â  }
Â  Â  renderCart();
}

window.updateCartBadge = function() {
Â  Â  const count = document.getElementById('cart-count');
Â  Â  count.textContent = cart.length;
Â  Â  count.classList.toggle('hidden', cart.length === 0);
}

window.renderCart = function() {
Â  Â  const cont = document.getElementById('cart-items');
Â  Â  const totalEl = document.getElementById('cart-total');
Â  Â  const btn = document.getElementById('btn-checkout');
Â  Â  if(cart.length === 0) {
Â  Â  Â  Â  cont.innerHTML = '<div class="text-center py-20 text-gray-400 italic">Vide...</div>';
Â  Â  Â  Â  totalEl.textContent = '0.00 â‚¬'; btn.disabled = true; return;
Â  Â  }
Â  Â  btn.disabled = false;
Â  Â  let total = 0;
Â  Â  cont.innerHTML = '';
Â  Â  cart.forEach(item => {
Â  Â  Â  Â  total += parseFloat(item.price);
Â  Â  Â  Â  cont.innerHTML += `
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-5 bg-white border p-5 rounded-[1.5rem]">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.image}" class="w-16 h-20 object-cover rounded-xl">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1"><h4 class="font-bold text-sm italic">${item.name}</h4><p class="text-indigo-600 font-black">${item.price} â‚¬</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="removeFromCart(${item.cartId})" class="text-gray-200 hover:text-red-500">&times;</button>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  });
Â  Â  totalEl.textContent = `${total.toFixed(2)} â‚¬`;
}

window.removeFromCart = (cid) => { cart = cart.filter(i => i.cartId !== cid); updateCartBadge(); renderCart(); }

window.checkout = async function() {
Â  Â  const nameInput = document.getElementById('client-name');
Â  Â  const name = nameInput.value;
Â  Â  if(!name.trim()) return alert("Identifiez-vous.");

Â  Â  const mode = prompt("1. Digital (Lecture site)\n2. Physique (Livraison)");
Â  Â  if(!mode) return;

Â  Â  if(mode === "1" || mode.toLowerCase().includes("digi")) {
Â  Â  Â  Â  if(cart.length > 1) {
Â  Â  Â  Â  Â  Â  alert("Vos ouvrages s'ouvrent dans des onglets sÃ©parÃ©s.");
Â  Â  Â  Â  Â  Â  cart.forEach(book => window.open(book.pdf, '_blank'));
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const book = cart[0];Â 
Â  Â  Â  Â  Â  Â  document.getElementById('pdf-viewer').src = book.pdf;
Â  Â  Â  Â  Â  Â  document.getElementById('reader-title').textContent = book.name;
Â  Â  Â  Â  Â  Â  document.getElementById('reader-modal').classList.add('active');
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  const msg = `ðŸ‘‘ ACQUISITION\nðŸ‘¤ CLIENT : ${name}\nðŸ“– LIVRES : ${cart.map(i=>i.name).join(", ")}\nðŸ’° TOTAL : ${document.getElementById('cart-total').textContent}`;
Â  Â  Â  Â  await fetch(`https://api.telegram.org/bot8383616774:AAGabewvnb_ix_84drSiTo9U-x68p_Znl-o/sendMessage`, {
Â  Â  Â  Â  Â  Â  method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({chat_id:"8296720386", text:msg})
Â  Â  Â  Â  });
Â  Â  Â  Â  alert("Ordre enregistrÃ©.");
Â  Â  }
Â  Â  cart = []; nameInput.value = ''; updateCartBadge(); toggleCart();
}

window.openAdminAuth = () => document.getElementById('auth-modal').classList.add('active');
window.closeModal = (id) => {Â 
Â  Â  document.getElementById(id).classList.remove('active');Â 
Â  Â  if(id==='reader-modal') document.getElementById('pdf-viewer').src = '';
}
window.verifyCode = () => {
Â  Â  const code = document.getElementById('admin-code');
Â  Â  if(code.value === SECRET_CODE) { isAdminActive = true; closeModal('auth-modal'); document.getElementById('add-modal').classList.add('active'); renderBooks(); }
Â  Â  else alert("RefusÃ©.");
Â  Â  code.value = '';
}
window.filterCategory = (cat) => {
Â  Â  currentFilter = cat;
Â  Â  document.querySelectorAll('.category-pill').forEach(btn => btn.classList.toggle('active', btn.textContent.trim() === cat));
Â  Â  renderBooks();
}
window.showToast = (msg) => {
Â  Â  const t = document.getElementById('toast'); t.textContent = msg;
Â  Â  t.classList.remove('opacity-0', 'translate-y-32');
Â  Â  setTimeout(() => t.classList.add('opacity-0', 'translate-y-32'), 3000);
}
window.deleteBook = async (id) => { if(confirm("Supprimer ?")) await deleteDoc(doc(db,"books",id)); }
window.editPrice = async (id) => { const p = prompt("Nouveau prix :"); if(p && !isNaN(p)) await updateDoc(doc(db,"books",id), {price: parseFloat(p).toFixed(2)}); }
</script>
</body>
</html>
